package ru.spbau.mit.wiki

import net.ruippeixotog.scalascraper.browser.JsoupBrowser
import net.ruippeixotog.scalascraper.dsl.DSL._
import net.ruippeixotog.scalascraper.scraper.ContentExtractors.text
import org.slf4j.{Logger, LoggerFactory}


object ConstantWikiParser extends WikiParser {
  val logger: Logger = LoggerFactory.getLogger("ConstantWikiParser")

  def loadVersion(url: String, title: String): String = {
    try {
      Thread.sleep(50)
      val version = JsoupBrowser().get(s"$url?title=$title&action=history") >> text(".mw-changeslist-date")
      logger.debug(s"Loaded version of $title")
      version
    } catch {
      case e: Exception =>
        logger.error(s"Failed to load version of $title: $e")
        ""
    }
  }

  def loadPageNode(name: String, url: String, title: String): TreeNode = PageNode(name, title, loadVersion(url, title))

  override def loadContent(url: String): TreeNode = SectionNode("root", List(
    SectionNode(s"1 –∫—É—Ä—Å üìÇ", List(
      SectionNode(s"–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ üìÇ", List(
        loadPageNode("–ú–∞—Ç–∞–Ω–∞–ª–∏–∑", url, "–ú–∞—Ç.–ê–Ω–∞–ª–∏–∑_1MIT_–æ—Å–µ–Ω—å2017"),
        loadPageNode("–û—Å–Ω–æ–≤—ã –î–ú –∏ –ú–õ", url, "–û—Å–Ω–æ–≤—ã_–î–ú_–∏_–ú–õ_1MIT_–æ—Å–µ–Ω—å2017"),
        loadPageNode("–ê–ª–≥–µ–±—Ä–∞", url, "–ê–ª–≥–µ–±—Ä–∞_1MIT_–æ—Å–µ–Ω—å2017"),
        loadPageNode("–ê–ª–≥–µ–±—Ä–∞ (—Ñ–∏–∑–∏–∫–∏)", url, "–ê–ª–≥–µ–±—Ä–∞_phys_1_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ üìÇ", List(
        loadPageNode("–ê–ª–≥–æ—Ä–∏—Ç–º—ã", url, "–ê–ª–≥–æ—Ä–∏—Ç–º—ã_1MIT_–æ—Å–µ–Ω—å2017"),
        loadPageNode("–ü–∞—Ä–∞–¥–∏–≥–º—ã –∏ –Ø–ü", url, "–ü–∞—Ä–∞–¥–∏–≥–º—ã_1MIT_–æ—Å–µ–Ω—å2017"),
      ))
    )),
    SectionNode(s"2 –∫—É—Ä—Å üìÇ", List(
      SectionNode(s"–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ üìÇ", List(
        loadPageNode("–ú–∞—Ç–∞–Ω–∞–ª–∏–∑", url, "–ú–∞—Ç_–∞–Ω–∞–ª–∏–∑_2MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–î–∏—Å–∫—Ä–µ—Ç–∫–∞", url, "–î–∏—Å–∫—Ä–µ—Ç–Ω–∞—è_–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞_2MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ê–ª–≥–µ–±—Ä–∞", url, "–ê–ª–≥–µ–±—Ä–∞_2MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ê–ª–≥–µ–±—Ä–∞ (—Ñ–∏–∑–∏–∫–∏)", url, "–ê–ª–≥–µ–±—Ä–∞_phys_2_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ üìÇ", List(
        loadPageNode("Java", url, "Java_2MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ê–ª–≥–æ—Ä–∏—Ç–º—ã", url, "–ê–ª–≥–æ—Ä–∏—Ç–º—ã_2MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–§–ü", url, "–§–ü_2MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≠–í–ú", url, "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞_–≠–í–ú_2MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ü—Ä–æ–µ–∫—Ç Java", url, "–ü—Ä–æ–µ–∫—Ç_Java_2MIT_–æ—Å–µ–Ω—å_2017")
      ))
    )),
    SectionNode(s"3 –∫—É—Ä—Å üìÇ", List(
      SectionNode(s"–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ üìÇ", List(
        loadPageNode("–ê–ª–≥–æ—Ä–∏—Ç–º—ã –¥–ª—è NP", url, "–ê–ª–≥–æ—Ä–∏—Ç–º—ã_–¥–ª—è_NP_—Ç—Ä—É–¥–Ω—ã—Ö_–∑–∞–¥–∞—á_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–î–∏—Ñ—Ñ—É—Ä—ã", url, "–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ_—É—Ä–∞–≤–Ω–µ–Ω–∏—è_3MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ú–µ—Ç–æ–¥—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏", url, "–ú–µ—Ç–æ–¥—ã_–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏_3MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ú–∞—Ç—Å—Ç–∞—Ç", url, "–ú–∞—Ç_—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞_3MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–§–æ—Ä–º–∞–ª—å–Ω—ã–µ —è–∑—ã–∫–∏", url, "–§–æ—Ä–º–∞–ª—å–Ω—ã–µ_—è–∑—ã–∫–∏_3MIT_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ üìÇ", List(
        loadPageNode("–ê–ª–≥–æ—Ä–∏—Ç–º—ã", url, "–ê–ª–≥–æ—Ä–∏—Ç–º—ã_3_3MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("Software Engineering", url, "Software_Engineering_3MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ë–î (–ë–∞—Ä–∞—à–µ–≤)", url, "–ë–∞–∑—ã_–¥–∞–Ω–Ω—ã—Ö_(–ë–∞—Ä–∞—à–µ–≤)_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–Ø–∑—ã–∫–∏ –¥–ª—è JVM", url, "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ_—è–∑—ã–∫–∏_–¥–ª—è_JVM_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–Ø–¥—Ä–æ Linux", url, "Linux_kernel_3MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("ROS", url, "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ_–≤_ROS_–æ—Å–µ–Ω—å_2017")
      ))
    )),
    SectionNode(s"4 –∫—É—Ä—Å üìÇ", List(
      SectionNode(s"–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ üìÇ", List(
        loadPageNode("–í—ã—á–≥–µ–æ–º–∞", url, "–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è_–≥–µ–æ–º–µ—Ç—Ä–∏—è_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ê–ª–≥–æ—Ä–∏—Ç–º—ã –¥–ª—è NP", url, "–ê–ª–≥–æ—Ä–∏—Ç–º—ã_–¥–ª—è_NP_—Ç—Ä—É–¥–Ω—ã—Ö_–∑–∞–¥–∞—á_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è", url, "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ_–ø—Ä–æ—Ç–æ–∫–æ–ª—ã_4MIT_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ üìÇ", List(
        loadPageNode("–ì–ª—É–±–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ", url, "Deep_learning_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ-2", url, "–ú–∞—à–∏–Ω–Ω–æ–µ_–æ–±—É—á–µ–Ω–∏–µ_2_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫", url, "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π_–ø–æ–∏—Å–∫_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ üìÇ", List(
        loadPageNode("–Ø–∑—ã–∫–∏ –¥–ª—è JVM", url, "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ_—è–∑—ã–∫–∏_–¥–ª—è_JVM_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞", url, "–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è_–≥—Ä–∞—Ñ–∏–∫–∞_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ë–î (–ß–µ—Ä–Ω—ã—à–µ–≤)", url, "–ë–∞–∑—ã_–¥–∞–Ω–Ω—ã—Ö_(–ß–µ—Ä–Ω—ã—à–µ–≤)_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("ROS", url, "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ_–≤_ROS_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("VM", url, "VM_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ üìÇ", List(
        loadPageNode("–ó–∞–≤–∏—Å–∏–º—ã–µ —Ç–∏–ø—ã", url, "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ_—Å_–∑–∞–≤–∏—Å–∏–º—ã–º–∏_—Ç–∏–ø–∞–º–∏_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–õ–æ–≥. –∏ —Ä–µ–ª. –ø—Ä–æ–≥—Ä.", url, "–õ–æ–≥–∏—á–µ—Å–∫–æ–µ_–∏_—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–µ_–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ_4MIT_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ú–µ—Ç–∞–≤—ã—á–∏—Å–ª–µ–Ω–∏—è", url, "–ú–µ—Ç–∞–≤—ã—á–∏—Å–ª–µ–Ω–∏—è_4MIT_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–î—Ä—É–≥–æ–µ üìÇ", List(
        loadPageNode("–ì—Ä–∞—Ñ. –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã", url, "–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ_–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã_–æ—Å–µ–Ω—å_2017")
      ))
    )),
    SectionNode(s"5 –∫—É—Ä—Å üìÇ", List(
      SectionNode(s"–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ üìÇ", List(
        loadPageNode("–ö–æ–º–±. –∏ –≥—Ä–∞—Ñ—ã", url, "–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞_–∏_—Ç–µ–æ—Ä–∏—è_–≥—Ä–∞—Ñ–æ–≤_5SE_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ê–ª–≥–æ—Ä–∏—Ç–º—ã", url, "–ê–ª–≥–æ—Ä–∏—Ç–º—ã_–∏_—Å—Ç—Ä—É–∫—Ç—É—Ä—ã_–¥–∞–Ω–Ω—ã—Ö_5SE_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ üìÇ", List(
        loadPageNode("–ë–î (–ë–∞—Ä–∞—à–µ–≤)", url, "–ë–∞–∑—ã_–¥–∞–Ω–Ω—ã—Ö_(–ë–∞—Ä–∞—à–µ–≤)_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ë–î (–ß–µ—Ä–Ω—ã—à–µ–≤)", url, "–ë–∞–∑—ã_–¥–∞–Ω–Ω—ã—Ö_(–ß–µ—Ä–Ω—ã—à–µ–≤)_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("Unix", url, "Unix_–∏_—Å–∫—Ä–∏–ø—Ç–æ–≤—ã–µ_—è–∑—ã–∫–∏_5SE_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–û–°", url, "OS_5SE_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("C++", url, "CPP_5SE_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–û—Å–Ω–æ–≤—ã –ü–ò", url, "–û—Å–Ω–æ–≤—ã_–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π_–∏–Ω–∂–µ–Ω–µ—Ä–∏–∏_5SE_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ üìÇ", List(
        loadPageNode("–§–ü", url, "–§–ü_5SE_–æ—Å–µ–Ω—å_2017")
      ))
    )),
    SectionNode(s"6 –∫—É—Ä—Å üìÇ", List(
      SectionNode(s"–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ üìÇ", List(
        loadPageNode("–í—ã—á–≥–µ–æ–º–∞ ", url, "–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è_–≥–µ–æ–º–µ—Ç—Ä–∏—è_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ üìÇ", List(
        loadPageNode("–ì–ª—É–±–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ", url, "Deep_learning_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ-2", url, "–ú–∞—à–∏–Ω–Ω–æ–µ_–æ–±—É—á–µ–Ω–∏–µ_2_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫", url, "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π_–ø–æ–∏—Å–∫_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ üìÇ", List(
        loadPageNode("–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞", url, "–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è_–≥—Ä–∞—Ñ–∏–∫–∞_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–Ø–∑—ã–∫–∏ –¥–ª—è JVM", url, "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ_—è–∑—ã–∫–∏_–¥–ª—è_JVM_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ü–∞—Ä–∞–ª–ª–µ–ª—å–∫–∞", url, "–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ_–∏_—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ_–≤—ã—á–∏—Å–ª–µ–Ω–∏—è_6SE_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("Java-II", url, "Java-II_6SE_–æ—Å–µ–Ω—å_2017"),
        // loadPageNode("–ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö (–ë–∞—Ä–∞—à–µ–≤)", url, "–ë–∞–∑—ã_–¥–∞–Ω–Ω—ã—Ö_(–ë–∞—Ä–∞—à–µ–≤)_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("–ë–î (–ß–µ—Ä–Ω—ã—à–µ–≤)", url, "–ë–∞–∑—ã_–¥–∞–Ω–Ω—ã—Ö_(–ß–µ—Ä–Ω—ã—à–µ–≤)_–æ—Å–µ–Ω—å_2017"),
        loadPageNode("VM", url, "VM_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ üìÇ", List(
        loadPageNode("–ó–∞–≤–∏—Å–∏–º—ã–µ —Ç–∏–ø—ã", url, "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ_—Å_–∑–∞–≤–∏—Å–∏–º—ã–º–∏_—Ç–∏–ø–∞–º–∏_–æ—Å–µ–Ω—å_2017")
      )),
      SectionNode(s"–î—Ä—É–≥–æ–µ üìÇ", List(
        loadPageNode("–ì—Ä–∞—Ñ. –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã", url, "–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ_–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã_–æ—Å–µ–Ω—å_2017")
      ))
    ))
  ))
}
